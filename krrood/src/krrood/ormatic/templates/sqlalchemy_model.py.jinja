# Generated by ORMatic

from __future__ import annotations
from sqlalchemy import Column, ForeignKey, Integer, String, Float, Boolean, DateTime, Enum, JSON, Table
from sqlalchemy.orm import relationship, Mapped, mapped_column, DeclarativeBase

{% for import in ormatic.imported_modules %}
import {{ import }}
{% endfor %}


from krrood.ormatic.dao import DataAccessObject, AssociationDataAccessObject
from krrood.ormatic.custom_types import TypeType

class Base(DeclarativeBase):
    type_mappings = {
    {% for key, value in ormatic.type_annotation_map.items() %}
        {{ key }}: {{ value }},
    {% endfor %}
    }


# Association tables for many-to-many relationships
{% for assoc_table in ormatic.association_objects %}
class {{ assoc_table.name }}(Base, AssociationDataAccessObject):

    __tablename__ = '{{ assoc_table.name }}'

    {{ assoc_table.primary_key_name }}: Mapped[int] = mapped_column(Integer, primary_key=True)
    {{ assoc_table.left_foreign_key }}: Mapped[int] = mapped_column(ForeignKey('{{ assoc_table.left_primary_key }}'))
    {{ assoc_table.right_foreign_key }}: Mapped[int] = mapped_column(ForeignKey('{{ assoc_table.right_primary_key }}'))

    target: Mapped[{{ assoc_table.right_table_name }}] = relationship('{{ assoc_table.right_table_name }}', foreign_keys=[{{ assoc_table.right_foreign_key }}])

{% endfor %}


{% for table in ormatic.wrapped_tables.values() %}
class {{ table.tablename }}({{ table.base_class_name }}, DataAccessObject[{{table.wrapped_clazz.name_with_entire_path}}]):

    __tablename__ = '{{ table.tablename }}'

    {{ table.primary_key }}


    {% for column in table.builtin_columns %}
    {{ column }}
    {% endfor %}

    {% for column in table.custom_columns %}
    {{ column }}
    {% endfor %}

    {% for column in table.foreign_keys %}
    {{ column }}
    {% endfor %}

    {% for column in table.relationships %}
    {{ column }}
    {% endfor %}

    {% if table.mapper_args %}
    __mapper_args__ = {
    {% for key, value in table.mapper_args.items() %}
        {{ key }}: {{ value }},
    {% endfor %}
    }
    {% endif %}

{% endfor %}
